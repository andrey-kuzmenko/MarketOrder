﻿@{
    ViewBag.Title = "Index";
}

@section Scripts {
    <script>
        $(document).ready(function () {
            MarketOrder.getProductsUrl = '@Url.Action("List", "Product")';
            $.get(MarketOrder.getProductsUrl, function (responce) {
                MarketOrder.init(responce);
            });
            ko.applyBindings(MarketOrder.vm);
        });
    </script>
}

<div class="container">
    <h1>Making an order</h1>
    <div class="row">
        <div class="col-12 col-md-8">
            <select data-bind="options: $root.Products, optionsText: 'Name', value: $root.Product().Item, optionsCaption: 'Choose...'"></select>
        </div>
    </div>
    <div class="row">
        <div class="col-6 col-md-4">
            <input type="text" data-bind="value: $root.Product().Price">
        </div>
        <div class="col-6 col-md-4">
            <input type="number" value="" min="0.0" data-bind="value: $root.Product().Discount" placeholder="Discount" step="0.01" pattern="^\$\d{1,3}(,\d{3})*(\.\d+)?$">
        </div>
        <div class="col-6 col-md-4">
            <input type="text" data-bind="value: $root.Product().Total">
        </div>
    </div>
    <button data-bind="click: MarketOrder.addOrder" class="btn btn-primary">Add</button>
</div>

<div class="container">
    <h1>New order</h1>
    <table class="table table-striped" data-bind="visible: $root.Orders().length > 0">
        <thead>
            <tr>
                <th>Index</th>
                <th>Name</th>
                <th>Price</th>
                <th>Count</th>
                <th>Total</th>
            </tr>
        </thead>
        <tbody data-bind="foreach: $root.Orders">
            <tr>
                <th scope="row">$index</th>
                <td><div data-bind="text: Name" /></td>
                <td><div data-bind="text: Price" /></td>
                <td><input type="number" value="" min="1" data-bind="value: Count" placeholder="Count" step="1"></td>
                <td><div data-bind="text: Total" /></td>
                <td><a href="#" data-bind="click: MarketOrder.removeOrder">Remove</a></td>
            </tr>
        </tbody>
    </table>
    <button data-bind="click: MarketOrder.createShipment" class="btn btn-primary">Create Order</button>
</div>

<div class="container">
    <h1>Orders approved for shipment</h1>
    <table class="table table-striped" data-bind="visible: $root.Shipments().length > 0">
        <thead>
            <tr>
                <th><strong>Order Number</strong></th>
                <th><strong>Products</strong></th>
                <th><strong>Price</strong></th>
            </tr>
        </thead>
        <tbody data-bind="foreach: $root.Shipments">
            <tr>
                <td><div data-bind="text: $index"></div></td>
                <td>
                    <div data-bind="foreach: Items">
                        <div data-bind="text: Name" />
                    </div>
                </td>
                <td><div data-bind="text: Total" /></td>
            </tr>
        </tbody>
    </table>
</div>